import{a as G,b as X}from"./chunk-X52XW5TZ.js";import{a as H}from"./chunk-2YE6EGPP.js";import{a as j}from"./chunk-Z24TDD3R.js";import{a as D}from"./chunk-OMGKDOXE.js";import{a as $}from"./chunk-7QLNNFJM.js";import{a as z}from"./chunk-2LEHSMYE.js";import{d as V,e as h,p as N,t as E}from"./chunk-XJFT56VC.js";import{$a as P,Da as q,Ha as y,Ma as I,Sa as l,Ta as U,Ua as F,Za as c,_a as a,a as A,aa as R,ab as T,b as B,ba as x,bb as M,cb as b,fb as g,gb as d,ja as L,nb as O,ob as u,pb as w,qb as _,wb as m,xb as v,ya as r,zb as k}from"./chunk-IDPMWJG7.js";function Y(n,t){if(n&1){let e=b();T(0),c(1,"app-classic-button",10),g("click",function(){R(e);let s=d(2).$implicit,o=d();return x(o.acceptRequest(s._id))}),u(2),m(3,"translate"),a(),M()}n&2&&(r(2),_(" ",v(3,1,"friendRequests.accept")," "))}function Z(n,t){if(n&1&&(T(0),I(1,Y,4,3,"ng-container",9),M()),n&2){let e=d().$implicit,i=O(9);r(),l("ngIf",!e.accepted)("ngIfElse",i)}}function ee(n,t){n&1&&(c(0,"span",11),u(1),m(2,"translate"),a()),n&2&&(r(),_(" ",v(2,1,"friendRequests.status.alreadyAccepted")," "))}function te(n,t){if(n&1&&(c(0,"span",11),u(1),m(2,"translate"),m(3,"translate"),a()),n&2){let e=d().$implicit;r(),_(" ",e.accepted?v(2,1,"friendRequests.status.accepted"):v(3,3,"friendRequests.status.pending")," ")}}function ie(n,t){if(n&1){let e=b();c(0,"div",4)(1,"app-avatar",5),g("click",function(s){let o=R(e).$implicit,p=d();return x(p.handleGoToProfile(s,o))}),a(),c(2,"div",6),g("click",function(s){let o=R(e).$implicit,p=d();return x(p.handleGoToProfile(s,o))}),c(3,"p",7),u(4),a(),c(5,"p",8),u(6),a()(),I(7,Z,2,2,"ng-container",9)(8,ee,3,3,"ng-template",null,0,k)(10,te,4,5,"ng-template",null,1,k),a()}if(n&2){let e=t.$implicit,i=O(11),s=d();r(4),_(" ",s.type==="received"?e.userIdEmissor.username:e.userIdReceiver.username," "),r(2),_(" ",s.type==="received"?e.userIdEmissor.email:e.userIdReceiver.email," "),r(),l("ngIf",s.type==="received")("ngIfElse",i)}}var S=class n{constructor(t){this.router=t}type="received";requests=[];accepted=new L;acceptRequest(t){this.accepted.emit(t)}handleGoToProfile(t,e){t.stopPropagation();let i=this.type==="received"?e.userIdEmissor._id:e.userIdReceiver._id;if(!i){console.error("\u274C No se puede navegar al perfil: ID indefinido");return}this.router.navigate(["/main/profile",i])}static \u0275fac=function(e){return new(e||n)(q(N))};static \u0275cmp=y({type:n,selectors:[["app-friend-request-list"]],inputs:{type:"type",requests:"requests"},outputs:{accepted:"accepted"},decls:2,vars:1,consts:[["acceptedText",""],["sentBlock",""],[1,"friend-request-container"],["class","friend-request-card",4,"ngFor","ngForOf"],[1,"friend-request-card"],[3,"click"],[1,"request-info",3,"click"],[1,"username"],[1,"email"],[4,"ngIf","ngIfElse"],["size","small",3,"click"],[1,"status-text"]],template:function(e,i){e&1&&(c(0,"div",2),I(1,ie,12,4,"div",3),a()),e&2&&(r(),l("ngForOf",i.requests))},dependencies:[$,z,V,h,E],styles:[".friend-request-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.friend-request-card[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background-color:var(--color-secondary);padding:.75rem 1rem;border-radius:10px}.request-info[_ngcontent-%COMP%]{flex:1;margin-left:1rem}.request-info[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-weight:600;color:var(--color-pure2);margin:0}.request-info[_ngcontent-%COMP%]   .email[_ngcontent-%COMP%]{font-size:.9rem;color:var(--muted);margin:2px 0 0}.status-text[_ngcontent-%COMP%]{color:var(--muted);font-weight:600}"]})};var C=class{_id;accepted;userIdEmissor;userIdReceiver;createdAt;constructor(t){this._id=t._id||"",this.accepted=t.accepted??!1;let e=i=>({_id:i,username:"Usuario",email:"email@example.com"});this.userIdEmissor=typeof t.userIdEmissor=="string"?e(t.userIdEmissor):{_id:t.userIdEmissor._id,username:t.userIdEmissor.username||"Usuario",email:t.userIdEmissor.email||"email@example.com"},this.userIdReceiver=typeof t.userIdReceiver=="string"?e(t.userIdReceiver):{_id:t.userIdReceiver._id,username:t.userIdReceiver.username||"Usuario",email:t.userIdReceiver.email||"email@example.com"},this.createdAt=t.createdAt||""}};function ne(n,t){if(n&1){let e=b();c(0,"app-friend-request-list",7),g("accepted",function(s){R(e);let o=d();return x(o.handleAccept(s))}),a()}if(n&2){let e=d();l("type","received")("requests",e.receivedRequests)}}function re(n,t){if(n&1&&P(0,"app-friend-request-list",8),n&2){let e=d();l("type","sent")("requests",e.sentRequests)}}function se(n,t){n&1&&(c(0,"div")(1,"h2",9),u(2),m(3,"translate"),a()()),n&2&&(r(2),w(v(3,1,"friendRequests.empty.sent")))}function oe(n,t){n&1&&(c(0,"div")(1,"h2",9),u(2),m(3,"translate"),a()()),n&2&&(r(2),w(v(3,1,"friendRequests.empty.received")))}var J=class n{constructor(t,e,i,s){this.friendRequestService=t;this.authService=e;this.userService=i;this.messageService=s}activeTab="received";receivedRequests=[];sentRequests=[];ngOnInit(){let t=this.authService.getUserId();t&&(this.friendRequestService.getReceivedRequests(t).subscribe({next:e=>{this.receivedRequests=e.map(i=>new C(i)),console.log("\u{1F4E5} Recibidas:",this.receivedRequests)},error:e=>console.error("\u274C Error al cargar solicitudes recibidas",e)}),this.friendRequestService.getSentRequests(t).subscribe({next:e=>{this.sentRequests=e.map(i=>new C(i)),console.log("\u{1F4E4} Enviadas:",this.sentRequests)},error:e=>console.error("\u274C Error al cargar solicitudes enviadas",e)}))}setTab(t){this.activeTab=t}handleAccept(t){let e=this.receivedRequests.find(o=>o._id===t);if(!e){console.error("\u274C No se encontr\xF3 la solicitud");return}let i=typeof e.userIdReceiver=="string"?e.userIdReceiver:e.userIdReceiver._id,s=typeof e.userIdEmissor=="string"?e.userIdEmissor:e.userIdEmissor._id;this.friendRequestService.respondToRequest(t,!0).subscribe({next:()=>{this.receivedRequests=this.receivedRequests.map(o=>o._id===t?B(A({},o),{accepted:!0}):o),console.log("\u2705 Solicitud aceptada:",t),this.userService.getFriendsByUserId(i).subscribe({next:o=>{let p=o.map(f=>f._id).filter(f=>typeof f=="string");p.includes(s)||p.push(s),this.userService.updateFriends(i,p).subscribe({next:()=>console.log("\u2705 Amigos del receptor actualizados")})}}),this.userService.getFriendsByUserId(s).subscribe({next:o=>{let p=o.map(f=>f._id).filter(f=>typeof f=="string");p.includes(i)||p.push(i),this.userService.updateFriends(s,p).subscribe({next:()=>{console.log("\u2705 Amigos del emisor actualizados");let f=new G({sender:{_id:i,username:e.userIdReceiver?.username||"Usuario",email:e.userIdReceiver?.email||"email@example.com"},recipient:{_id:s,username:e.userIdEmissor?.username||"Usuario",email:e.userIdEmissor?.email||"email@example.com"},content:"\xA1Hola! Ahora somos amigos :D"});this.messageService.create(f).subscribe({next:()=>console.log("\u{1F4E9} Mensaje de bienvenida enviado autom\xE1ticamente"),error:K=>console.error("\u274C Error al enviar mensaje autom\xE1tico",K)})}})}})},error:o=>console.error("\u274C Error al aceptar solicitud",o)})}static \u0275fac=function(e){return new(e||n)(q(H),q(D),q(j),q(X))};static \u0275cmp=y({type:n,selectors:[["app-friend-request-page"]],decls:13,vars:16,consts:[[1,"other-buttons"],[1,"tab-button",3,"click"],[1,"underline"],[1,"tab-content"],[3,"type","requests","accepted",4,"ngIf"],[3,"type","requests",4,"ngIf"],[4,"ngIf"],[3,"accepted","type","requests"],[3,"type","requests"],[1,"empty-message"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"button",1),g("click",function(){return i.setTab("received")}),u(2),m(3,"translate"),a(),c(4,"button",1),g("click",function(){return i.setTab("sent")}),u(5),m(6,"translate"),a(),P(7,"div",2),a(),c(8,"div",3),I(9,ne,1,2,"app-friend-request-list",4)(10,re,1,2,"app-friend-request-list",5)(11,se,4,3,"div",6)(12,oe,4,3,"div",6),a()),e&2&&(r(),F("active",i.activeTab==="received"),r(),_(" ",v(3,12,"friendRequests.received")," "),r(2),F("active",i.activeTab==="sent"),r(),_(" ",v(6,14,"friendRequests.sent")," "),r(2),U("transform",i.activeTab==="received"?"translateX(12%)":"translateX(135%)"),r(2),l("ngIf",i.activeTab==="received"),r(),l("ngIf",i.activeTab==="sent"),r(),l("ngIf",i.activeTab==="sent"&&i.sentRequests.length===0),r(),l("ngIf",i.activeTab==="received"&&i.receivedRequests.length===0))},dependencies:[S,h,E],styles:[".empty-message[_ngcontent-%COMP%]{color:var(--color-pure2);text-align:center}.other-container[_ngcontent-%COMP%]{margin-top:-50px;padding:1rem;background-color:var(--color-secondary);color:var(--color-pure2);border-radius:10px}.other-buttons[_ngcontent-%COMP%]{display:flex;position:relative;border-bottom:2px solid var(--muted);margin-bottom:1rem}.tab-button[_ngcontent-%COMP%]{background:none;border:none;padding:10px 20px;cursor:pointer;font-weight:600;color:var(--muted);position:relative}.tab-button.active[_ngcontent-%COMP%]{color:var(--color-pure2)}.underline[_ngcontent-%COMP%]{position:absolute;bottom:0;height:3px;width:90px;background-color:var(--color-primary);transition:all .3s ease;transform:translate(0)}.tab-content[_ngcontent-%COMP%]{max-height:150px}.tab-panel[_ngcontent-%COMP%]{display:none}.tab-panel.active[_ngcontent-%COMP%]{display:block}"]})};export{J as FriendRequestPageComponent};
