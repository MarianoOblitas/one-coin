import{a as oe}from"./chunk-PXU6GBA3.js";import{b as H,d as J,f as K,i as Q,n as W}from"./chunk-OYNSWCUO.js";import{a as E}from"./chunk-JANLSDFQ.js";import{a as te}from"./chunk-6ZI4JPIT.js";import{a as b}from"./chunk-I5FS3M5K.js";import{a as Z}from"./chunk-OMGKDOXE.js";import{a as ee}from"./chunk-7QLNNFJM.js";import{a as P}from"./chunk-2LEHSMYE.js";import{d as $,e as O,f as w,g as Y,n as q,p as T,t as X}from"./chunk-XJFT56VC.js";import{$ as V,$a as c,Da as u,Eb as G,Ha as v,Ma as C,Sa as p,Za as n,_a as r,a as F,aa as k,b as L,ba as y,cb as x,fb as d,gb as f,ja as S,ob as m,pb as g,qb as _,wb as h,xa as j,xb as N,ya as s,yb as M}from"./chunk-IDPMWJG7.js";var B=class i{commentSubmitted=new S;contentControl=new K("");submitComment(){let o=this.contentControl.value?.trim();o&&(this.commentSubmitted.emit(o),this.contentControl.reset())}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["app-comment-form"]],outputs:{commentSubmitted:"commentSubmitted"},decls:10,vars:8,consts:[[1,"comment-form-container"],[1,"form-area"],["rows","3",1,"comment-input",3,"formControl","placeholder"],[1,"comment-actions"],["type","image"],[3,"click","size"]],template:function(e,t){e&1&&(n(0,"div",0),c(1,"app-avatar"),n(2,"div",1),c(3,"textarea",2),h(4,"translate"),n(5,"div",3),c(6,"app-icon-button",4),n(7,"app-classic-button",5),d("click",function(){return t.submitComment()}),m(8),h(9,"translate"),r()()()()),e&2&&(s(3),p("formControl",t.contentControl)("placeholder",N(4,4,"comment.placeholder")),s(4),p("size","small"),s(),_(" ",N(9,6,"comment.submit")," "))},dependencies:[W,H,J,Q,ee,P,b,X],styles:[".comment-form-container[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1rem;border-bottom:1px solid var(--muted)}.form-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.8rem;font-weight:500}.comment-input[_ngcontent-%COMP%]{width:100%;border:none;resize:none;font-size:1rem;font-family:inherit;color:var(--color-pure2);background-color:transparent;outline:none;border-bottom:1px solid var(--muted)}.comment-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.icon-button[_ngcontent-%COMP%]{background-color:var(--muted);border:none;border-radius:50%;padding:.5rem;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color .3s ease}.icon-button[_ngcontent-%COMP%]:hover{background-color:#0000001a}"]})};function re(i,o){if(i&1){let e=x();n(0,"div",2)(1,"div",3)(2,"app-avatar",4),d("click",function(a){let l=k(e).$implicit,A=f();return y(A.handleGoToProfile(a,l))}),r(),n(3,"div",5),d("click",function(a){let l=k(e).$implicit,A=f();return y(A.handleGoToProfile(a,l))}),n(4,"p",6),m(5),r(),n(6,"div",7)(7,"span",8),m(8),r(),n(9,"span",9),m(10,"\u2022"),r(),n(11,"span",10),m(12),h(13,"date"),r()()()(),n(14,"div",11),m(15),r(),n(16,"div",12)(17,"div",13),c(18,"app-icon-button",14),n(19,"span"),m(20,"0"),r()()()()}if(i&2){let e=o.$implicit;s(5),g(e.userId.username||"Usuario"),s(3),g(e.userId.email||"email@example.com"),s(4),g(M(13,4,e.createdAt,"shortDate")),s(3),_(" ",e.content," ")}}var D=class i{constructor(o){this.router=o}comments=[];handleGoToProfile(o,e){let t=e.userId._id;if(!t){console.error("\u274C No se puede navegar: comment.userId._id es undefined",e);return}o.stopPropagation(),this.router.navigate(["/main/profile",t])}static \u0275fac=function(e){return new(e||i)(u(T))};static \u0275cmp=v({type:i,selectors:[["app-comment-list"]],inputs:{comments:"comments"},decls:2,vars:1,consts:[[1,"comment-wrapper"],["class","comment-container",4,"ngFor","ngForOf"],[1,"comment-container"],[1,"comment-header"],[3,"click"],[1,"comment-info",3,"click"],[1,"username"],[1,"metadata"],[1,"email"],[1,"dot"],[1,"date"],[1,"comment-content"],[1,"comment-footer"],[1,"action-button","like-btn"],["type","heart"]],template:function(e,t){e&1&&(n(0,"div",0),C(1,re,21,7,"div",1),r()),e&2&&(s(),p("ngForOf",t.comments))},dependencies:[P,b,$,w],styles:[".comments-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column-reverse}.comment-container[_ngcontent-%COMP%]{background-color:var(--color-secondary);color:var(--color-pure2);padding:1rem;margin-bottom:1rem;border-bottom:1px solid var(--color-primary);display:flex;flex-direction:column;gap:.8rem}.comment-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.comment-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.username[_ngcontent-%COMP%]{font-weight:600;font-size:1rem;margin:0}.metadata[_ngcontent-%COMP%]{font-size:.85rem;color:var(--muted);display:flex;gap:.5rem}.dot[_ngcontent-%COMP%]{font-weight:700}.comment-content[_ngcontent-%COMP%]{font-size:1rem;color:var(--color-pure2)}.comment-footer[_ngcontent-%COMP%]{display:flex;gap:2rem;align-items:center}.action-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.1rem;cursor:pointer;font-size:.95rem;color:var(--muted)}"]})};function se(i,o){if(i&1&&(n(0,"div",14),c(1,"img",15),r()),i&2){let e=f();s(),p("src",e.post.images[0],j)}}var U=class i{constructor(o){this.router=o}post;likedByUser=!1;likeToggled=new S;handleLikeClick(){this.likeToggled.emit()}handleGoToProfile(o,e){let t=e.author._id;if(!t){console.error("\u274C No se puede navegar: post.author._id es undefined",e);return}o.stopPropagation(),this.router.navigate(["/main/profile",t])}ngOnChanges(){console.log("\u{1F7E2} Cambi\xF3 likedByUser en post-card:",this.likedByUser)}static \u0275fac=function(e){return new(e||i)(u(T))};static \u0275cmp=v({type:i,selectors:[["app-post-card"]],inputs:{post:"post",likedByUser:"likedByUser"},outputs:{likeToggled:"likeToggled"},features:[V],decls:23,vars:11,consts:[[1,"post-card"],[1,"post-header"],[3,"click"],[1,"user-info",3,"click"],[1,"username"],[1,"email"],[1,"post-content"],["class","post-image",4,"ngIf"],[1,"post-date"],[1,"post-actions"],[1,"action-button","like-btn",3,"click"],["type","heart",3,"liked"],[1,"action-button","comment-btn"],["type","comment"],[1,"post-image"],["alt","Post image",3,"src"]],template:function(e,t){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"app-avatar",2),d("click",function(l){return t.handleGoToProfile(l,t.post)}),r(),n(3,"div",3),d("click",function(l){return t.handleGoToProfile(l,t.post)}),n(4,"p",4),m(5),r(),n(6,"p",5),m(7),r()()(),n(8,"div",6),m(9),r(),C(10,se,2,1,"div",7),n(11,"div",8),m(12),h(13,"date"),r(),n(14,"div",9)(15,"div",10),d("click",function(){return t.handleLikeClick()}),c(16,"app-icon-button",11),n(17,"span"),m(18),r()(),n(19,"div",12),c(20,"app-icon-button",13),n(21,"span"),m(22),r()()()()),e&2){let a,l;s(5),g((t.post==null||t.post.author==null?null:t.post.author.username)||"Usuario"),s(2),g((t.post==null||t.post.author==null?null:t.post.author.email)||"email@example.com"),s(2),_(" ",(t.post==null?null:t.post.content)||"Sin contenido"," "),s(),p("ngIf",t.post==null||t.post.images==null?null:t.post.images.length),s(2),_(" ",t.post!=null&&t.post.createdAt?M(13,8,t.post.createdAt,"short"):"Sin fecha"," "),s(4),p("liked",t.likedByUser),s(2),g((a=t.post==null?null:t.post.likesCount)!==null&&a!==void 0?a:0),s(4),g((l=t.post==null?null:t.post.commentsCount)!==null&&l!==void 0?l:0)}},dependencies:[O,P,b,w],styles:[".post-card[_ngcontent-%COMP%]{padding:1rem;background-color:var(--color-secondary);color:var(--color-pure2);border-radius:10px;display:flex;flex-direction:column;gap:1rem}.post-header[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.user-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.username[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem;margin:0}.email[_ngcontent-%COMP%]{font-size:.9rem;color:var(--muted);margin:0}.post-content[_ngcontent-%COMP%]{font-size:1.1rem;line-height:1.5}.post-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;border-radius:10px;object-fit:cover}.post-date[_ngcontent-%COMP%]{color:var(--muted);font-size:.85rem}.post-actions[_ngcontent-%COMP%]{display:flex;gap:2rem;align-items:center;border-bottom:1px solid var(--muted);border-top:1px solid var(--muted);padding:.6rem 0}.action-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;cursor:pointer;font-size:.95rem;color:var(--muted)}.icon-wrapper[_ngcontent-%COMP%]{background-color:var(--color-secondary);padding:6px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease}"]})};var I=class{_id;content;postId;userId;createdAt;updatedAt;constructor(o){this._id=o._id||o.id||"",this.content=o.content||"",this.postId=o.postId||"",this.userId={_id:o.userId?._id||o.userId?.id||"",username:o.userId?.username||"",email:o.userId?.email||void 0},this.createdAt=o.createdAt||"",this.updatedAt=o.updatedAt||""}};function ae(i,o){if(i&1){let e=x();n(0,"app-post-card",5),d("likeToggled",function(){k(e);let a=f(2);return y(a.handleToggleLike())}),r()}if(i&2){let e=f(2);p("post",e.post)("likedByUser",e.likedByUser)}}function me(i,o){if(i&1){let e=x();n(0,"div",1),C(1,ae,1,2,"app-post-card",2),n(2,"app-comment-form",3),d("commentSubmitted",function(a){k(e);let l=f();return y(l.handleSubmitComment(a))}),r(),c(3,"app-comment-list",4),r()}if(i&2){let e=f();s(),p("ngIf",e.post),s(2),p("comments",e.comments)}}var ie=class i{constructor(o,e,t,a,l){this.route=o;this.postService=e;this.commentService=t;this.authService=a;this.cdr=l}post=null;comments=[];likedByUser=!1;ngOnInit(){let o=this.route.snapshot.paramMap.get("id");o&&this.postService.getById(o).subscribe({next:e=>{this.post=new E(e);let t=this.authService.getUserId();console.log("\u2705 Usuario logueado:",t),console.log("\u{1F4E6} Likes del post:",this.post.likes),t&&(this.likedByUser=this.post.likes.some(a=>a.toString()===t.toString()),this.cdr.detectChanges(),console.log("\u2764\uFE0F \xBFYa dio like?",this.likedByUser)),this.loadComments(e._id)},error:e=>console.error("\u274C Error al cargar el post:",e)})}loadComments(o){this.commentService.getAllByParamId("postId",o).subscribe({next:e=>{this.comments=e.map(t=>new I(t))},error:e=>console.error("\u274C Error al cargar comentarios:",e)})}handleSubmitComment(o){if(!this.post)return;let e={content:o,postId:this.post._id};this.commentService.create(e).subscribe({next:t=>{this.comments.push(new I(t))},error:t=>console.error("\u274C Error al crear comentario:",t)})}handleToggleLike(){this.post&&this.postService.toggleLike(this.post._id).subscribe({next:()=>{let o=this.authService.getUserId();if(!o)return;this.post.likes.includes(o)?(this.post=new E(L(F({},this.post),{likes:this.post.likes.filter(t=>t!==o),likesCount:this.post.likesCount-1})),this.likedByUser=!1):(this.post=new E(L(F({},this.post),{likes:[...this.post.likes,o],likesCount:this.post.likesCount+1})),this.likedByUser=!0)},error:o=>{console.error("\u274C Error al alternar like:",o)}})}isLikedByUser(o){let e=this.authService.getUserId();return e?o.likes.includes(e):!1}static \u0275fac=function(e){return new(e||i)(u(q),u(te),u(oe),u(Z),u(G))};static \u0275cmp=v({type:i,selectors:[["app-post-detail-page"]],decls:1,vars:1,consts:[["class","post-detail",4,"ngIf"],[1,"post-detail"],[3,"post","likedByUser","likeToggled",4,"ngIf"],[3,"commentSubmitted"],[3,"comments"],[3,"likeToggled","post","likedByUser"]],template:function(e,t){e&1&&C(0,me,4,2,"div",0),e&2&&p("ngIf",t.post)},dependencies:[Y,O,B,D,U],styles:[".post-detail[_ngcontent-%COMP%]{border:1px solid var(--color-primary)}"]})};export{ie as PostDetailPageComponent};
